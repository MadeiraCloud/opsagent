#cloud-config
##
## Bootstrap cloudinit script for MadeiraCloud OpsAgent
## Version 0.0.1a
## @author: Thibault BRONCHAIN
##
## (c) 2014 MadeiraCloud LTD.
##

# user-data
app_id: %app_id%
token: %token%

# Packages required
packages:
  - curl
  - tar
  - %python%
%add_pkg%

# Bootstrap commands
runcmd:
  - cd /root
  - curl -O https://s3.amazonaws.com/visualops/agent.tgz
  - cd /
  - tar xfz /root/agent.tgz
  - python2.7 /madeira/bootstrap/virtualenv/virtualenv.py /madeira/env
  - cp -r /madeira/sources/ws4py /madeira/env/lib/python2.7/site-packages/
  - cp -r /madeira/sources/salt /madeira/env/lib/python2.7/site-packages/
  - cp -r /madeira/sources/opsagent /madeira/env/lib/python2.7/site-packages/
  - chown -R root:root /madeira

# EOF
